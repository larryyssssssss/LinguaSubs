<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinguaSubs - 字幕词汇通</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <a href="#main-content" class="skip-link">跳转到主内容</a>
    
    <!-- 首页视图 -->
    <div id="home-view" role="main" tabindex="-1">
        <div class="user-info">
            <span id="user-id-display">用户ID: </span>
        </div>
        <h1>LinguaSubs - 字幕词汇通</h1>
        <div class="sample-section">
            <h2>示例影片</h2>
            <div id="movie-list" role="region" aria-label="示例影片列表">
                <!-- 电影卡片将在这里动态生成 -->
            </div>
        </div>
        <div class="library-section">
            <h2>我的媒体库</h2>
            <div id="user-library" role="region" aria-label="用户媒体库">
                <!-- 用户媒体库将在这里动态生成 -->
            </div>
        </div>
        <div class="upload-section">
            <h2>上传字幕文件</h2>
            <div class="upload-container">
                <input type="file" id="subtitle-upload" accept=".srt" aria-label="选择SRT字幕文件" />
                <label for="subtitle-upload" class="upload-btn" role="button" tabindex="0">📁 选择SRT字幕文件</label>
                <button id="open-upload-modal" class="upload-btn" aria-label="上传新字幕">📤 上传新字幕</button>
                <div id="upload-status" aria-live="polite"></div>
            </div>
        </div>
    </div>

    <!-- 学习视图 -->
    <div id="study-view" class="hidden" role="main" tabindex="-1">
        <div class="study-header">
            <div class="header-left">
                <button id="back-to-home" class="nav-btn home-nav-btn" aria-label="返回首页">🏠 返回首页</button>
                <h1 id="movie-title">电影名称</h1>
            </div>
            <div class="header-controls">
                <div class="mode-toggle" role="radiogroup" aria-label="学习模式">
                    <button id="browse-mode-btn" class="mode-btn active" role="radio" aria-checked="true" tabindex="0">浏览模式</button>
                    <button id="review-mode-btn" class="mode-btn" role="radio" aria-checked="false" tabindex="0">复习模式</button>
                </div>
                <button id="export-btn" class="export-btn" aria-label="导出词汇表">📤 导出</button>
                <button id="settings-btn" class="settings-btn" aria-label="设置">⚙️ 设置</button>
                <button id="help-btn" class="help-btn" aria-label="帮助">?</button>
            </div>
        </div>
        
        <div class="study-container" id="main-content">
            <!-- 左侧：单词列表 -->
            <div class="word-list-panel" role="region" aria-label="词汇列表">
                <h2>词汇列表</h2>
                <div id="word-list-container" role="list">
                    <!-- 单词列表将在这里动态生成 -->
                </div>
            </div>
            
            <!-- 右侧：单词详情/学习卡片 -->
            <div class="word-detail-panel" role="region" aria-label="单词详情">
                <div id="word-card" role="article">
                    <div class="word-header">
                        <h2 id="word" aria-label="单词"></h2>
                        <span id="phonetic" aria-label="音标"></span>
                        <button id="pronunciation-btn" aria-label="发音">🔊 发音</button>
                    </div>
                    <div class="study-navigation">
                        <button id="back-to-home" class="nav-btn" aria-label="返回首页">🏠 返回首页</button>
                        <button id="back-to-word-list" class="back-btn hidden" aria-label="返回单词列表">← 返回单词列表</button>
                    </div>
                    <!-- 进度指示器 -->
                    <div id="study-progress" class="study-progress hidden">
                        <span id="current-card">0</span> / <span id="total-cards">0</span>
                    </div>
                    <!-- 翻面按钮 -->
                    <div id="flip-container" class="flip-container hidden">
                        <button id="flip-btn" class="flip-btn">翻面查看释义</button>
                    </div>
                    <div id="definition" class="definition" aria-label="单词释义"></div>
                    <div id="example-sentence" class="example-sentence" aria-label="例句"></div>
                    <div class="feedback-buttons" role="group" aria-label="学习反馈">
                        <button id="forgot-btn" aria-label="忘记了">忘记了</button>
                        <button id="review-btn" aria-label="需巩固">需巩固</button>
                        <button id="known-btn" aria-label="我认识">我认识</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 设置面板 -->
        <div id="settings-panel" class="settings-panel hidden" role="dialog" aria-labelledby="settings-title" aria-modal="true">
            <div class="settings-content">
                <div class="settings-header">
                    <h2 id="settings-title">设置</h2>
                    <button id="close-settings-btn" class="close-btn" aria-label="关闭设置">✕</button>
                </div>
                
                <div class="settings-section">
                    <h3>词频过滤</h3>
                    <div class="setting-item">
                        <label for="min-frequency">最小出现次数:</label>
                        <input type="number" id="min-frequency" min="1" value="1" aria-label="最小出现次数">
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>熟练度标签</h3>
                    <div class="setting-item">
                        <label for="beginner-label">生词标签:</label>
                        <input type="text" id="beginner-label" value="生词" aria-label="生词标签">
                    </div>
                    <div class="setting-item">
                        <label for="intermediate-label">学习中标签:</label>
                        <input type="text" id="intermediate-label" value="学习中" aria-label="学习中标签">
                    </div>
                    <div class="setting-item">
                        <label for="advanced-label">已掌握标签:</label>
                        <input type="text" id="advanced-label" value="已掌握" aria-label="已掌握标签">
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>词典设置</h3>
                    <div class="setting-item">
                        <label for="dictionary-api">词典API:</label>
                        <select id="dictionary-api" aria-label="词典API">
                            <option value="free-dictionary">Free Dictionary API</option>
                            <option value="oxford">Oxford Dictionary</option>
                            <option value="cambridge">Cambridge Dictionary</option>
                        </select>
                    </div>
                </div>
                
                <div class="settings-actions">
                    <button id="save-settings-btn" class="save-btn" aria-label="保存设置">保存设置</button>
                    <button id="reset-settings-btn" class="reset-btn" aria-label="重置默认">重置默认</button>
                    <button id="clear-cache-btn" class="reset-btn" aria-label="清除缓存">清除缓存</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 快捷键帮助面板 -->
    <div id="shortcut-help" class="shortcut-help hidden" role="dialog" aria-labelledby="shortcut-help-title" aria-modal="true">
        <div class="shortcut-help-content">
            <div class="shortcut-help-header">
                <h3 id="shortcut-help-title">键盘快捷键</h3>
                <button id="close-shortcut-help" class="close-shortcut-help" aria-label="关闭快捷键帮助">×</button>
            </div>
            <div class="shortcut-help-body">
                <div class="shortcut-item">
                    <span class="shortcut-key">1</span>
                    <span class="shortcut-key">←</span>
                    <span class="shortcut-desc">忘记了</span>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-key">2</span>
                    <span class="shortcut-key">空格</span>
                    <span class="shortcut-desc">需巩固</span>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-key">3</span>
                    <span class="shortcut-key">→</span>
                    <span class="shortcut-desc">我认识</span>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-key">B</span>
                    <span class="shortcut-desc">浏览模式</span>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-key">R</span>
                    <span class="shortcut-desc">复习模式</span>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-key">S</span>
                    <span class="shortcut-desc">设置</span>
                </div>
                <div class="shortcut-item">
                    <span class="shortcut-key">E</span>
                    <span class="shortcut-desc">导出</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 上传模态框 -->
    <div id="upload-modal" class="modal hidden" role="dialog" aria-labelledby="upload-modal-title" aria-modal="true">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="upload-modal-title">上传新字幕</h2>
                <button id="close-upload-modal" class="close-modal" aria-label="关闭上传模态框">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="movie-title-input">电影标题:</label>
                    <input type="text" id="movie-title-input" placeholder="请输入电影标题" required aria-label="电影标题">
                </div>
                <div class="form-group">
                    <label for="subtitle-file">字幕文件 (.srt):</label>
                    <input type="file" id="subtitle-file" accept=".srt" required aria-label="选择字幕文件">
                </div>
                <div class="form-group">
                    <label for="cover-file">封面图片 (可选):</label>
                    <input type="file" id="cover-file" accept="image/*" aria-label="选择封面图片">
                </div>
                <div class="form-actions">
                    <button id="submit-upload" class="submit-btn" aria-label="上传">上传</button>
                    <button id="cancel-upload" class="cancel-btn" aria-label="取消">取消</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 单词详情浮层 -->
    <div id="word-popover" class="word-popover hidden" role="dialog" aria-labelledby="popover-word" aria-modal="true">
        <div class="popover-content">
            <div class="popover-header">
                <h3 id="popover-word" class="popover-word"></h3>
                <button id="close-popover" class="close-popover" aria-label="关闭">×</button>
            </div>
            <div class="popover-body">
                <div id="popover-phonetic" class="popover-phonetic"></div>
                <div id="popover-definition" class="popover-definition"></div>
                <div id="popover-example" class="popover-example"></div>
            </div>
        </div>
    </div>

    <!-- 引入Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- 引入Supabase配置 -->
    <script src="supabase-config.js"></script>
    <script src="js/supabaseConfig.js" type="module"></script>
    <script src="js/supabaseClient.js" type="module"></script>
    <!-- 将使用模块的脚本标记为type="module" -->
    <script src="js/data.js" type="module"></script>
    <script src="js/utils.js" type="module"></script>
    <script src="js/api.js" type="module"></script>
    <script src="js/srs.js" type="module"></script>
    <script src="js/dataService.js" type="module"></script>
    <script src="js/loadingManager.js" type="module"></script>
    <script src="js/stateManager.js" type="module"></script>
    <script src="js/router.js" type="module"></script>
    <script src="js/main.js" type="module"></script>
    <script>
        // 初始化Supabase配置
        console.log("Supabase集成已加载");
    </script>
</body>
</html>